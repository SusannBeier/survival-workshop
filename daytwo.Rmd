---
title: "Time-to-event analysis"
author: "Thomas Lumley"
date: "2017-9-13"
output: ioslides_presentation
---

## Questions?

<img src="weka_hires.jpg" height=500">

## Recurrent events

Nothing in the formulas requires people to go away after they have an event. We don't even need to rewrite the partial likelihood

$$p(\beta)= \frac{\lambda_0(t)e^{z_i(t)\beta}}{\sum_{j\textrm{ observed at } t} \lambda_0(t)e^{z_j(t)\beta}}=\frac{e^{z_i(t)\beta}}{\sum_{j\textrm{ observed at } t} e^{z_j(t)\beta}}$$

Now we are asking about how the **current** value of $z$ affects the rate of events.

Define $Y_i(s)=1$ between the starting time and ending time, $Y_i(s)=0$ otherwise. All the same formulas work. 


We also recurrent events for free<sup>*</sup>!

<sup>*</sup> <sup>terms and conditions apply</sup>

## Computation

Multiple records, just as for time-varying predictors

More than one record for a given person can end with an event

We need an `id` variable to track which records are the same person

## Issues

**Correlation**: people who have had an event may be at higher risk of a second

- because the first event really increased their risk (eg sprain)
- because the first event revealed they were at high risk (eg asthma)

Easy to handle: variance estimator using `id` variable, similar to GEE for longitudinal data

- `+cluster(id)` in model formula for R
- `, cluster(id)` option for Stata
- `ID` statement and `COVS(AGGREGATE)` option in SAS

---

**Time scale**: should we be comparing

- people at the same time after a fixed time zero?
- people at the same time after their previous event?

Either can make sense: need to think about what you want. 






## Competing risks

Example: tumours are removed surgically, and the surgeon is interested whether the removal is complete enough

- surgery couldn't do anything about metastases
- surgeon wants the time to *local* recurrence, censored at death or distant recurrence

Example: blood pressure treatment reduces risk of stroke and heart disease

- researchers want time to stroke or heart attack
- deaths from other causes wouldn't be affected by treatment, use as censoring time

## Problem

Ignorable censoring assumption would say that someone who died of another cause was still at the same risk of stroke or heart attack or local recurrence as someone still alive

They aren't. They're dead. 

Ignorable censoring **can't be** true in the usual sense

## What can we estimate?

**Crude incidence**: what proportion of people get/don't get local recurrence or stroke by time $t$? Crude incidences add up to $1-\hat{S}(t)$

**Cause-specific hazard**: rate of events from a specific cause. Cause-specific hazards add up to $\hat{\Lambda}(t)$

Both involve removing the effect of actual censoring, but not of competing risks. 

## Not the same

Example: 

- group 1: rates of  30%/year for cancer and non-cancer deaths
- group 2: cancer rate of 20%/year, non-cancer rate of 10%/year


Cause-specific hazard of cancer is higher in group 1, but more people eventually die of cancer in group 2 because they don't die of other things first. 

Crude incidence and cause-specific hazard need not agree unless all event probabilities are low.

## Computation

- Cause-specific hazards are what you estimate if you do a Cox model 'censoring' at deaths from other causes
- Crude incidence is what you estimate if you say someone dying of one cause never dies of other causes and is censored at the end of the study -- but that gets the standard errors wrong.

R package `cmprsk` does crude-incidence comparisons and regression models

`-stcrreg-` and `-stcurve-` in Stata'

`eventcode` option to `PHREG` in SAS
